<head>
  <style type="text/css">
    
    #borde {
     
      border:1px solid;
      border-radius:15px;
      -moz-border-radius:15px;
    }
    
    
  </style>
  
  
</head>

<p id="notice"><%= notice %></p>
<div>
  <p>
    <strong><%= @issue.Title %></strong>
    <p>Issue #<%= @issue.id%></p>
  </p>
</div>

<div>
  <p>
  <p><strong> <%#= User.find(request.query_parameters[:id]=@issue.user_id).name %></strong> created an issue <small><font color="gray"><%= time_ago_in_words(@issue.created_at) + " ago" %></font></small></p> 
  <p><%= @issue.Description %></p>
</div>
<% if current_user.id == @issue.user_id %> 
<div class="issue-toolbar">
  <div class="dropdown">
      <span style="margin-right:5px; background: #8D8DF4; padding:8px; font-weight: bold">
        <% if @issue.Status == "Open" || @issue.Status == "New" %>
          <a class="resolved"> <%= link_to 'Resolve', update_status_url(id: @issue.id, status: "Resolved"), method: :put %> </a>
        <% else %>
          <%= link_to 'Open', update_status_url(id: @issue.id, status: "Open"), method: :put, class:'open'%>
        <% end %>
      </span>
      
        <button class="show-button dropdown-toggle next-to" type="button" data-toggle="dropdown">Workflow
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <% Issue.status.each do |status| %>
            <% if status != @issue.Status %>
              <%= content_tag(:li, link_to(status, update_status_url(id: @issue.id, status: status), method: :put)) %>
            <% end %>
          <% end %>
        </ul>
        <a href="#" data-toggle="modal" data-target="#attachmodal" class="show-button">Attach</a>

        <a href="/issues/<%= @issue.id %>/edit" class="show-button">Edit</a>
      
        <%= link_to 'Delete', @issue,  method: :delete, class: 'show-button', data: { confirm: 'Are you sure you want to delete this issue?' } %>
    </div>
  </div>
</div>
<%end%>
<HR>
 <div class="col-md-8">
        
        <h2>Comentarios (<%= @issue.comments.count %>)</h2>
        
        <% @issue.comments.each do |comment| %>
          <div class="comments">
            
            <p class="comenter">
              <%= User.find(comment.user_id).name %>
            </p>
           
            <p class="coment">
              <%= comment.body %>
              </br>      
            </p>
            
             <p> <% if comment.user_id == current_user.id%>
             <%= link_to 'Delete Comment', [Issue.find(comment.issue_id), comment],
                       method: :delete,
                       data: { confirm: 'Are you sure?' } , class: "esborrar" %> .
              <% end %>
              <small><font color="gray"><%= time_ago_in_words(comment.created_at) + " ago" %></font></small></p>
          </div>
          </br>
        <% end %>


        <%= form_with(model: [@issue, @issue.comments.build], local: true) do |form| %>
        <div>
          <%= form.text_area :body %>
          <br>
          <%= form.submit :class => 'submit' %>

        </div>
      <% end %>
      </div>
    </div>
    
  </div>
</div>
<HR>
  
<div id="borde">
  <table class="egt">
    <tr>
    <td>Assignee</td>
    <% if !@issue.assignee_id.nil? %>
       <td><%= link_to User.find(request.query_parameters[:id]=@issue.assignee_id).name, issues_url(assignee_id: @issue.assignee_id), class:"btn-link" %><td>
    <% else %>
    <td>-</td>
    <% end %>
  </tr>
  <tr>
    <td>Type</td>
    <td><%= @issue.Type %></td>
  </tr>
  <tr>
    <td>Priority</td>
    <td><%= @issue.Priority %></td>
  </tr>
  <tr>
    <td>Status</td>
    <td><%= @issue.Status %></td>
  </tr>
  <tr>
    <td>Votes</td>
     <td> <%= @issue.votes.size %>
        <% if !Vote.exists?(:issue_id => @issue.id, :user_id => current_user.id) %>
        <%= link_to 'Vote for this issue', vot_path(id: @issue.id), method: :post, class:"vote" %>
        <% else %>
        <%= link_to 'Remove vote', vot_path(id: @issue.id), method: :post, class:"vote" %>
        <% end %>
      </td>
  </tr>
  <tr>
    <td>Watchers</td>
    <td><%= @issue.Watchers %>
      <% if !Watcher.exists?(:issue_id => @issue.id, :user_id => current_user.id) %>
                <%= link_to 'Watch', watch_url(id: @issue.id, index: "id"), method: :post, class:"watcher" %>
              <%else %>
                <%= link_to 'Unwatch', watch_url(id: @issue.id, index: "id"), method: :post, class:"watcher" %>
              <% end %>
    </td>
  </tr>
</table>
  
</div>

<div class="page-actions">
      <%= link_to new_issue_path, class: 'create-button' do %>
        <span class="glyphicon glyphicon-plus"></span>
        <span class="createi-button">Create issue</span>
      <% end %>
  </div>
  
<%= link_to 'Back', issues_path %>